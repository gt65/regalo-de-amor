<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Presiona el corazon ‚ù§Ô∏è</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
  <style>
    :root {
      --bg: #0a0a0f;
      --fg: #ffffff;
      --pink: #ffd6e7;
      --heart: #ff2b4f;
      --shadow: rgba(255, 43, 79, 0.6);
      --textGlow: 0 0 .6rem rgba(255, 214, 231, .9);
      --maxWidth: 1200px;
      --messageBoxBg: rgba(139, 69, 119, 0.6); /* Rosa oscuro transl√∫cido */
    }

    * { 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Sour Gummy", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--fg);
      background: linear-gradient(to bottom, #000000, #2a3a6b); /* Degradado nocturno m√°s suave */
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .scene {
      position: relative;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      isolation: isolate;
    }

    .scene[data-bg="stars"] {
      background: linear-gradient(to bottom, #000000, #2a3a6b); /* Cielo nocturno m√°s suave */
    }
    .scene[data-bg="stars"]::before,
    .scene[data-bg="stars"]::after {
      content: "";
      position: absolute; inset: -50% -50%;
      background-repeat: repeat;
      pointer-events: none;
      z-index: -1;
      will-change: opacity;
    }
    .scene[data-bg="stars"]::before {
      background-image:
        radial-gradient(3px 3px at 15px 25px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 45px 75px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 85px 45px, #fff 50%, transparent 51%), radial-gradient(3px 3px at 125px 15px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 165px 95px, #fff 50%, transparent 51%), radial-gradient(3px 3px at 205px 35px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 245px 65px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 285px 25px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 325px 85px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 365px 55px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 405px 15px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 445px 75px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 20px 120px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 100px 180px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 180px 140px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 260px 200px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 340px 160px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 420px 220px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 60px 300px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 140px 280px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 480px 350px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 30px 250px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 190px 320px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 380px 80px, #fff 50%, transparent 51%), radial-gradient(3px 3px at 120px 300px, #fff 50%, transparent 51%),
        radial-gradient(4px 4px at 300px 50px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 50px 180px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 250px 150px, #fff 50%, transparent 51%), radial-gradient(2px 2px at 400px 280px, #fff 50%, transparent 51%);
      background-size: 500px 400px;
      animation: twinkleA 4s ease-in-out infinite;
      opacity: 1;
    }
    .scene[data-bg="stars"]::after {
      background-image:
        radial-gradient(2px 2px at 30px 40px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 70px 90px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 110px 20px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 150px 130px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 190px 70px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 230px 110px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 270px 50px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 310px 150px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 350px 30px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 390px 100px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 430px 170px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 470px 60px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 80px 190px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 120px 240px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 160px 210px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 200px 280px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 240px 220px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 280px 290px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 320px 260px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 360px 300px, #fff 50%, transparent 51%),
        radial-gradient(2px 2px at 50px 350px, #fff 50%, transparent 51%), radial-gradient(1px 1px at 220px 30px, #fff 50%, transparent 51%),
        radial-gradient(3px 3px at 300px 90px, #fff 50%, transparent 51%);
      background-size: 500px 350px;
      animation: twinkleB 6s ease-in-out infinite;
      opacity: 0.8;
    }
    
    @keyframes twinkleA { 
      0% { opacity: 1; }
      25% { opacity: 0.3; }
      50% { opacity: 0.8; }
      75% { opacity: 0.2; }
      100% { opacity: 1; }
    }
    
    @keyframes twinkleB { 
      0% { opacity: 0.8; }
      20% { opacity: 0.2; }
      40% { opacity: 0.9; }
      60% { opacity: 0.3; }
      80% { opacity: 0.7; }
      100% { opacity: 0.8; }
    }

    .heart-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      /* Ajuste para m√≥viles: mover el coraz√≥n hacia arriba */
      transform: translateY(-40px);
    }
    .instruction-container {
    position: absolute;
    bottom: 15%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 5;
    width: 100%;
    max-width: 800px;
    padding: 0 20px;
    opacity: 1;
    transition: opacity 1s ease;
  }

  /* Ocultar instrucciones despu√©s del primer clic */
  .instruction-container.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .instruction-text {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .instruction-words {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px 15px;
    margin-bottom: 8px;
  }

  .word {
    font-family: "Sour Gummy", sans-serif;
    font-size: clamp(24px, 4vw, 42px);
    font-weight: 800;
    color: var(--pink);
    text-shadow: 
      0 0 15px rgba(255, 43, 79, 0.7),
      0 0 30px rgba(255, 43, 79, 0.4),
      0 2px 4px rgba(0, 0, 0, 0.5);
    letter-spacing: 1px;
    padding: 5px 15px;
    background: rgba(139, 69, 119, 0.2);
    border-radius: 20px;
    border: 1px solid rgba(255, 214, 231, 0.3);
    backdrop-filter: blur(5px);
    animation: wordFloat 3s ease-in-out infinite;
    transform-origin: center;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  /* Animaciones individuales para cada palabra */
  .word:nth-child(1) {
    animation-delay: 0s;
    background: linear-gradient(45deg, rgba(255, 43, 79, 0.3), rgba(139, 69, 119, 0.3));
  }

  .word:nth-child(2) {
    animation-delay: 0.2s;
    background: linear-gradient(45deg, rgba(139, 69, 119, 0.3), rgba(255, 107, 129, 0.3));
  }

  .word:nth-child(3) {
    animation-delay: 0.4s;
    background: linear-gradient(45deg, rgba(255, 107, 129, 0.3), rgba(255, 43, 79, 0.3));
  }

  .word:nth-child(4) {
    animation-delay: 0.6s;
    background: linear-gradient(45deg, rgba(255, 43, 79, 0.3), rgba(255, 182, 193, 0.3));
    font-size: clamp(28px, 4.5vw, 48px);
  }

  .word:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 10px 25px rgba(255, 43, 79, 0.4),
      0 0 40px rgba(255, 214, 231, 0.3);
  }

  .instruction-subtitle {
    font-family: "Sour Gummy", sans-serif;
    font-size: clamp(16px, 2vw, 24px);
    color: var(--pink);
    text-shadow: 
      0 0 10px rgba(255, 214, 231, 0.7),
      0 2px 4px rgba(0, 0, 0, 0.5);
    opacity: 0.9;
    letter-spacing: 2px;
    font-weight: 500;
    padding: 8px 25px;
    background: rgba(139, 69, 119, 0.15);
    border-radius: 15px;
    border: 1px solid rgba(255, 214, 231, 0.2);
    backdrop-filter: blur(5px);
    animation: subtitlePulse 4s ease-in-out infinite;
  }

  /* Efecto de brillo alrededor */
  .instruction-container::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120%;
    height: 150%;
    background: radial-gradient(
      ellipse at center,
      rgba(255, 43, 79, 0.1) 0%,
      rgba(255, 43, 79, 0.05) 40%,
      transparent 70%
    );
    pointer-events: none;
    z-index: -1;
  }

  /* Animaciones */
  @keyframes wordFloat {
    0%, 100% {
      transform: translateY(0) scale(1);
      box-shadow: 
        0 5px 15px rgba(255, 43, 79, 0.3),
        0 0 25px rgba(255, 214, 231, 0.2);
    }
    50% {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 
        0 15px 30px rgba(255, 43, 79, 0.4),
        0 0 40px rgba(255, 214, 231, 0.3);
    }
  }

  @keyframes subtitlePulse {
    0%, 100% {
      opacity: 0.8;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.02);
    }
  }

  /* Efecto de part√≠culas en las instrucciones */
  .instruction-particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: var(--pink);
    border-radius: 50%;
    pointer-events: none;
    opacity: 0;
    filter: blur(1px);
  }

  /* Responsive para m√≥viles */
  @media (max-width: 768px) {
    .instruction-container {
      bottom: 10%;
      padding: 0 15px;
    }
    
    .instruction-words {
      gap: 8px 12px;
    }
    
    .word {
      font-size: clamp(20px, 5vw, 32px);
      padding: 4px 12px;
      border-radius: 15px;
    }
    
    .word:nth-child(4) {
      font-size: clamp(22px, 5.5vw, 36px);
    }
    
    .instruction-subtitle {
      font-size: clamp(14px, 3vw, 18px);
      padding: 6px 20px;
      border-radius: 12px;
    }
  }

  /* Para pantallas muy peque√±as */
  @media (max-width: 480px) {
    .instruction-container {
      bottom: 8%;
    }
    
    .instruction-words {
      flex-direction: column;
      gap: 8px;
    }
    
    .word {
      font-size: 22px;
      padding: 8px 20px;
      width: fit-content;
      margin: 0 auto;
    }
    
    .instruction-subtitle {
      font-size: 14px;
      padding: 8px 16px;
    }
  }

  /* Para pantallas grandes */
  @media (min-height: 900px) {
    .instruction-container {
      bottom: 20%;
    }
  }
    /* Solo en pantallas m√°s grandes, volver a la posici√≥n normal */
    @media (min-height: 800px) {
      .heart-container {
        transform: translateY(0);
      }
    }

    .heart-btn { 
      display: grid; place-items: center; 
      width: clamp(280px, 40vmin, 520px); 
      height: clamp(280px, 40vmin, 520px);
      border: none; background: transparent; cursor: pointer; 
      filter: drop-shadow(0 0 40px rgba(255, 43, 79, .55));
      transition: transform .1s ease;
      z-index: 2;
    }
    .heart-btn:active { transform: scale(.95); }

    .heart { 
      width: 85%; height: 85%; display: block; 
      transform-origin: center center;
      will-change: transform;
    }
    .heart svg { width: 100%; height: 100%; display: block; overflow: visible; }

    .heart svg .core {
      fill: var(--heart);
      filter: drop-shadow(0 0 20px var(--shadow)) drop-shadow(0 0 40px rgba(255, 43, 79, .4));
      animation: gentleBeat 2.5s ease-in-out infinite;
      transform-origin: 50% 50%;
    }

    .heart svg .shine { fill: rgba(255,255,255,.35); mix-blend-mode: screen; }

    @keyframes gentleBeat { 
      0%, 100% { transform: scale(1); } 
      50% { transform: scale(1.05); } 
    }

    .heart-btn.clicked .heart svg .core {
      animation: strongBeat 0.7s cubic-bezier(0.17, 0.67, 0.83, 0.67), gentleBeat 2.5s ease-in-out infinite 0.7s;
    }

    @keyframes strongBeat {
      0% { transform: scale(1); }
      15% { transform: scale(1.8); } /* M√°s grande */
      30% { transform: scale(0.6); } /* M√°s peque√±o */
      45% { transform: scale(1.6); } /* Rebote grande */
      60% { transform: scale(0.7); } /* Rebote peque√±o */
      75% { transform: scale(1.3); } /* Casi de vuelta */
      90% { transform: scale(0.9); } /* Peque√±a contracci√≥n */
      100% { transform: scale(1); }
    }

    .phrase {
      position: absolute;
      display: inline-block;
      padding: .8em 1.4em;
      background: var(--messageBoxBg); /* Rosa oscuro transl√∫cido */
      border-radius: 25px;
      border: 1px solid rgba(255,214,231,.3);
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,.6), var(--textGlow);
      pointer-events: none;
      font-size: clamp(14px, 2.2vw, 26px);
      color: var(--pink);
      opacity: 0;
      z-index: 10;
      box-shadow: 0 8px 32px rgba(255, 43, 79, .2);
      transform: translate(-50%, -50%);
      white-space: nowrap;
      will-change: transform, opacity;
    }

    .phrase.shooting {
      animation: shootAndFall var(--duration, 6s) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }

    @keyframes shootAndFall {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(.5) rotate(var(--rotation, 0deg));
      }
      10% {
        opacity: 1;
        transform: translate(calc(-50% + var(--shoot-x)), calc(-50% + var(--shoot-y))) scale(1.1) rotate(var(--rotation, 0deg));
      }
      15% {
        transform: translate(calc(-50% + var(--shoot-x)), calc(-50% + var(--shoot-y))) scale(1) rotate(var(--rotation, 0deg));
      }
      90% {
        opacity: 1;
        transform: translate(calc(-50% + var(--final-x)), calc(-50% + var(--final-y))) scale(.85) rotate(var(--final-rotation, 0deg));
      }
      100% {
        opacity: 0;
        transform: translate(calc(-50% + var(--final-x)), calc(-50% + var(--final-y))) scale(.7) rotate(var(--final-rotation, 0deg));
      }
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--heart);
      border-radius: 50%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      will-change: transform, opacity;
    }

    .particle.burst {
      animation: particleBurst 1s ease-out forwards;
    }
    /* Efectos de aura */
    .heart-aura {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 43, 79, 0.2) 0%, transparent 70%);
      opacity: 0;
      z-index: 0;
      pointer-events: none;
    }

    .heart-aura.active {
      animation: auraPulse 0.8s ease-out;
    }
    @keyframes auraPulse {
      0% { transform: scale(0.8); opacity: 0.8; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    @keyframes particleBurst {
      0% {
        opacity: 1;
        transform: scale(1.2);
      }
      100% {
        opacity: 0;
        transform: scale(0) translate(var(--particle-x, 0px), var(--particle-y, 0px));
      }
    }

    /* Reproductor de m√∫sica */
    .music-player {
      position: fixed;
      top: 20px; /* Movido a la parte superior */
      left: 50%;
      transform: translateX(-50%);
      background: var(--messageBoxBg);
      padding: 10px 18px; /* Reducido el padding vertical */
      border-radius: 20px; /* M√°s redondeado pero menos alto */
      border: 1px solid rgba(255,214,231,.3);
      box-shadow: 0 8px 32px rgba(255, 43, 79, .2);
      display: flex;
      align-items: center;
      gap: 12px; /* Reducido el gap */
      z-index: 100;
      backdrop-filter: blur(10px);
      min-width: 260px; /* Reducido el ancho m√≠nimo */
      opacity: 0;
      transform: translateX(-50%) translateY(-100%); /* Animaci√≥n desde arriba */
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .music-player.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .play-pause-btn {
      background: rgba(255, 43, 79, 0.8);
      border: none;
      border-radius: 50%;
      width: 36px; /* Reducido ligeramente */
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 43, 79, 0.3);
    }

    .play-pause-btn:hover {
      background: rgba(255, 43, 79, 1);
      transform: scale(1.05);
    }

    .play-pause-btn svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .progress-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px; /* Reducido el gap */
    }

    .song-info {
      font-size: 13px; /* Reducido ligeramente */
      color: var(--pink);
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      font-weight: 500;
    }

    .progress-bar {
      width: 100%;
      height: 3px; /* Reducido ligeramente */
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      overflow: hidden;
      cursor: pointer;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff2b4f, #ff5f7a);
      border-radius: 2px;
      width: 0%;
      transition: width 0.1s ease;
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      font-size: 11px; /* Reducido ligeramente */
      color: rgba(255, 214, 231, 0.8);
      font-weight: 400;
    }
    /* BOT√ìN ABRIR CARTA */
.letter-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 20px;
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(14px, 2vw, 18px);
  font-weight: 800;
  color: var(--pink);
  background: linear-gradient(45deg, 
    rgba(139, 69, 119, 0.4), 
    rgba(255, 43, 79, 0.4));
  border: 2px solid rgba(255, 214, 231, 0.4);
  border-radius: 50px;
  cursor: pointer;
  text-shadow: 
    0 0 10px rgba(255, 43, 79, 0.8),
    0 0 20px rgba(255, 43, 79, 0.4),
    0 2px 4px rgba(0, 0, 0, 0.6);
  letter-spacing: 1.5px;
  display: row;  /* Cambi√© de "row" a "flex" */
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: 
    0 5px 20px rgba(255, 43, 79, 0.3),
    0 0 30px rgba(255, 214, 231, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  overflow: hidden;
  z-index: 10;
  animation: letterBtnFloat 3s ease-in-out infinite;
  transform-origin: right bottom; /* Cambi√© el origen de transformaci√≥n */
}
/* Animaciones para posici√≥n derecha */
@keyframes letterBtnFloat {
  0%, 100% {
    transform: translateY(0);
    box-shadow: 
      0 5px 20px rgba(255, 43, 79, 0.3),
      0 0 30px rgba(255, 214, 231, 0.2);
  }
  50% {
    transform: translateY(-5px);
    box-shadow: 
      0 10px 25px rgba(255, 43, 79, 0.4),
      0 0 35px rgba(255, 214, 231, 0.25);
  }
}

.letter-btn:hover {
  transform: translateY(-3px);
  background: linear-gradient(45deg, 
    rgba(139, 69, 119, 0.6), 
    rgba(255, 43, 79, 0.6));
  border-color: rgba(255, 214, 231, 0.8);
  box-shadow: 
    0 10px 30px rgba(255, 43, 79, 0.5),
    0 0 40px rgba(255, 214, 231, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.letter-btn:active {
  transform: translateY(0) scale(0.98);
  transition: transform 0.1s ease;
}

.letter-icon {
  font-size: clamp(18px, 2.5vw, 22px);
  filter: drop-shadow(0 0 5px rgba(255, 214, 231, 0.8));
  animation: envelopeShake 2s ease-in-out infinite;
}

.letter-text {
  background: linear-gradient(45deg, #ffd6e7, #ff8fab);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: none;
  position: relative;
  white-space: nowrap;
}

@keyframes envelopeShake {
  0%, 100% {
    transform: translateY(0) rotate(0deg);
  }
  25% {
    transform: translateY(-2px) rotate(-5deg);
  }
  75% {
    transform: translateY(-2px) rotate(5deg);
  }
}

/* Para m√≥viles */
@media (max-width: 768px) {
  .letter-btn {
    bottom: 15px;
    right: 15px;
    padding: 8px 16px;
    font-size: clamp(12px, 2.5vw, 16px);
  }
}

@media (max-width: 480px) {
  .letter-btn {
    bottom: 10px;
    right: 10px;
    padding: 6px 12px;
    gap: 6px;
  }
  
  .letter-text {
    font-size: 12px;
  }
}

/* Modal de carta */
.letter-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
  backdrop-filter: blur(10px);
}

.letter-modal.active {
  opacity: 1;
  pointer-events: all;
}

.letter-content {
  background: linear-gradient(135deg, 
    rgba(139, 69, 119, 0.9),
    rgba(88, 28, 78, 0.9));
  border: 3px solid rgba(255, 214, 231, 0.4);
  border-radius: 20px;
  padding: 30px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 
    0 20px 60px rgba(255, 43, 79, 0.4),
    0 0 100px rgba(255, 214, 231, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  transform: scale(0.9);
  transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.letter-modal.active .letter-content {
  transform: scale(1);
}

.letter-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255, 43, 79, 0.8);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  color: white;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 10;
}

.letter-close:hover {
  background: rgba(255, 43, 79, 1);
  transform: scale(1.1) rotate(90deg);
}

.letter-header {
  text-align: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid rgba(255, 214, 231, 0.3);
}

.letter-title {
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(28px, 4vw, 40px);
  color: #ffd6e7;
  text-shadow: 
    0 0 20px rgba(255, 43, 79, 0.8),
    0 2px 8px rgba(0, 0, 0, 0.6);
  margin-bottom: 10px;
}

.letter-subtitle {
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(16px, 2vw, 20px);
  color: #ff8fab;
  opacity: 0.9;
}

.letter-body {
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(18px, 2.5vw, 22px);
  line-height: 1.6;
  color: #ffd6e7;
  text-align: justify;
}

.letter-footer {
  margin-top: 25px;
  text-align: center;
  padding-top: 15px;
  border-top: 2px solid rgba(255, 214, 231, 0.3);
  font-style: italic;
  color: #ff8fab;
  font-size: clamp(16px, 2vw, 18px);
}

/* Efectos de part√≠culas en el modal */
.letter-particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--pink);
  border-radius: 50%;
  pointer-events: none;
  z-index: 1;
  opacity: 0;
}

/* Responsive */
@media (max-width: 768px) {
  .letter-btn {
    bottom: 8%;
    padding: 12px 24px;
    font-size: clamp(16px, 4vw, 22px);
  }
  
  .letter-content {
    padding: 20px;
    max-height: 85vh;
  }
  
  .letter-close {
    width: 35px;
    height: 35px;
    font-size: 18px;
  }
}

@media (max-width: 480px) {
  .letter-btn {
    bottom: 6%;
    padding: 10px 20px;
    flex-direction: column;
    gap: 8px;
  }
  
  .letter-content {
    padding: 15px;
    width: 95%;
  }
}

/* MENSAJES DE PROGRESO DE CARTA - ENCIMA DEL CORAZ√ìN */
.progress-message {
  position: absolute;
  top: 20%; /* Cambi√© de bottom a top */
  left: 50%;
  transform: translateX(-50%);
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(18px, 3vw, 28px);
  color: var(--pink);
  text-shadow: 
    0 0 15px rgba(255, 43, 79, 0.8),
    0 0 30px rgba(255, 43, 79, 0.4),
    0 2px 6px rgba(0, 0, 0, 0.6);
  text-align: center;
  padding: 15px 30px;
  background: rgba(139, 69, 119, 0.3);
  border-radius: 25px;
  border: 1px solid rgba(255, 214, 231, 0.3);
  backdrop-filter: blur(10px);
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 5;
  white-space: nowrap;
  box-shadow: 0 8px 32px rgba(255, 43, 79, 0.2);
  animation: progressMessageFloat 3s ease-in-out infinite;
}

@keyframes progressMessageFloat {
  0%, 100% {
    transform: translateX(-50%) translateY(0);
  }
  50% {
    transform: translateX(-50%) translateY(-5px);
  }
}

.progress-message.active {
  opacity: 1;
}

.progress-message.fade-out {
  opacity: 0;
}

/* Bot√≥n ABRIR CARTA - Inicialmente oculto */
.letter-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 20px;
  font-family: "Sour Gummy", sans-serif;
  font-size: clamp(14px, 2vw, 18px);
  font-weight: 800;
  color: var(--pink);
  background: linear-gradient(45deg, 
    rgba(139, 69, 119, 0.4), 
    rgba(255, 43, 79, 0.4));
  border: 2px solid rgba(255, 214, 231, 0.4);
  border-radius: 50px;
  cursor: pointer;
  text-shadow: 
    0 0 10px rgba(255, 43, 79, 0.8),
    0 0 20px rgba(255, 43, 79, 0.4),
    0 2px 4px rgba(0, 0, 0, 0.6);
  letter-spacing: 1.5px;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: 
    0 5px 20px rgba(255, 43, 79, 0.3),
    0 0 30px rgba(255, 214, 231, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  overflow: hidden;
  z-index: 10;
  animation: letterBtnFloat 3s ease-in-out infinite;
  transform-origin: right bottom;
  opacity: 0;
  pointer-events: none;
}

.letter-btn.ready {
  opacity: 1;
  pointer-events: all;
}

@keyframes letterBtnFloat {
  0%, 100% {
    transform: translateY(0);
    box-shadow: 
      0 5px 20px rgba(255, 43, 79, 0.3),
      0 0 30px rgba(255, 214, 231, 0.2);
  }
  50% {
    transform: translateY(-5px);
    box-shadow: 
      0 10px 25px rgba(255, 43, 79, 0.4),
      0 0 35px rgba(255, 214, 231, 0.25);
  }
}

.letter-btn:hover {
  transform: translateY(-3px);
  background: linear-gradient(45deg, 
    rgba(139, 69, 119, 0.6), 
    rgba(255, 43, 79, 0.6));
  border-color: rgba(255, 214, 231, 0.8);
  box-shadow: 
    0 10px 30px rgba(255, 43, 79, 0.5),
    0 0 40px rgba(255, 214, 231, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}
  </style>
</head>
<body>
  <div class="scene" id="scene" data-bg="stars">
    <div class="heart-aura" id="heartAura"></div>
    
    <div class="heart-container">
      <button class="heart-btn" id="heartBtn">
        <span class="heart">
          <svg viewBox="0 0 200 180" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="g" cx="50%" cy="40%" r="70%">
                <stop offset="0%" stop-color="#ff5f7a" />
                <stop offset="40%" stop-color="#ff2b4f" />
                <stop offset="100%" stop-color="#c91534" />
              </radialGradient>
            </defs>
            <path class="core" d="M100,162.2C17.7,99.5,6,77.5,6,52.3C6,27.1,27.1,6,52.3,6c15.4,0,30.8,7.7,40,20.6l7.7,9.6l7.7-9.6 c9.2-12.9,24.6-20.6,40-20.6c25.2,0,46.3,21.1,46.3,46.3c0,25.2-11.7,47.2-94,109.9L100,162.2L100,162.2z" fill="url(#g)"/>
            <path class="shine" d="M73 47c-12 0-23 6-29 16-2 3-1 7 2 9 3 2 7 1 9-2 4-7 12-11 20-11 4 0 7-3 7-7s-3-5-9-5Z"/>
          </svg>
        </span>
      </button>
    </div>
    <div class="instruction-container">
      <div class="instruction-text">
        <span class="instruction-words">
          <span class="word">Presiona el coraz√≥n ‚ù§Ô∏è</span>
        </span>
        <div class="instruction-subtitle">y descubre mensajes de amor</div>
      </div>
    </div>
    <button class="letter-btn" id="letterBtn">
        <span class="letter-icon">‚úâÔ∏è</span>
        <span class="letter-text">ABRIR CARTA</span>
        <div class="letter-glow"></div>
        
    </button>
    <!-- Reproductor de m√∫sica -->
    <div class="music-player" id="musicPlayer">
      <button class="play-pause-btn" id="playPauseBtn">
        <svg id="playIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 5v14l11-7z"/>
        </svg>
        <svg id="pauseIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="display: none;">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
      </button>
      <div class="progress-container">
        <div class="song-info">Te dedico esta canci√≥n ‚ù§Ô∏è</div>
        <div class="progress-bar" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="time-display">
          <span id="currentTime">0:00</span>
          <span id="totalTime">0:00</span>
        </div>
      </div>
    </div>

  </div>

  <audio id="audioPlayer" loop>
    <source src="https://www.dropbox.com/scl/fi/c0q2xs3wqpter1nboovfc/Alex-Warren-Ordinary-Official-Video.mp3?rlkey=abyjuqf1qi9ensg74b7ahwkxg&st=39ic68fq&dl=1" type="audio/mpeg">
  </audio>

  <script>
    const PHRASES = [
      "Eres mi mejor aventura ‚ú® üíñ", "Contigo todo es magia üåô üíñ", 
      "Mi refugio favorito eres t√∫ üè° üíñ","Eres mi promesa de felicidad eterna ü§ùüíñ",
      "Eres mi canci√≥n infinita üé∂ üíñ", "Mi destino eres t√∫ üí´ üíñ",
      "Nuestro amor ser√° eterno üî• üíñ", "A tu lado, soy feliz üíñ",
      "Te amo cada d√≠a m√°s üíñ", "Tu amor es mi inspiraci√≥n üé® üíñ",
      "Eres mi hogar y mi aventura üó∫Ô∏è üíñ", "Contigo el tiempo se detiene ‚è∞ üíñ",
      "Te amo m√°s de lo que las palabras pueden expresar ‚ù§Ô∏è","Eres el amor de mi vida üíï",
      "Amo cada detalle de ti, sin excepciones üíñ"
    ];

    const scene = document.getElementById('scene');
    const heartBtn = document.getElementById('heartBtn');
    const heartAura = document.getElementById('heartAura');
    const musicPlayer = document.getElementById('musicPlayer');
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const currentTimeEl = document.getElementById('currentTime');
    const totalTimeEl = document.getElementById('totalTime');
    
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    
    let isProcessing = false;
    let firstClick = true;
    let isPlaying = false;
    let currentPhraseIndex = 0;
    let instructionHidden = false;
    // A√±ade estas variables
    let messagesShown = [];
    let progressMessageActive = false;
    let allPhrasesShown = false; // Nueva variable para controlar estado finall
    const PROGRESS_MESSAGES = [
      { threshold: 0.3, text: "üìù Preparando carta..." },
      { threshold: 0.5, text: "‚ú® Ya casi listo..." },
      { threshold: 1.0, text: "üíå ¬°Carta lista!" }
    ];
    function triggerRelease(e) {
      if (e.type === 'keydown' && e.key !== 'Enter' && e.key !== ' ') {
        return;
      }
      e.preventDefault();
      
      if (isProcessing) return;
      isProcessing = true;

      // Activar m√∫sica en el primer clic
      if (firstClick) {
        activateMusic();
        firstClick = false;
      }

      releasePhrase();

      setTimeout(() => {
        isProcessing = false;
      }, 300);
    }

    function activateMusic() {
      musicPlayer.classList.add('active');
      audioPlayer.play()
        .then(() => {
          isPlaying = true;
          showPauseIcon();
        })
        .catch(e => {
          console.log('Error al reproducir audio:', e);
        });
    }

    function showPlayIcon() {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    }

    function showPauseIcon() {
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
    }

    function togglePlayPause() {
      if (isPlaying) {
        audioPlayer.pause();
        showPlayIcon();
        isPlaying = false;
      } else {
        audioPlayer.play()
          .then(() => {
            showPauseIcon();
            isPlaying = true;
          })
          .catch(e => {
            console.log('Error al reproducir audio:', e);
          });
      }
    }

    function updateProgress() {
      if (audioPlayer.duration) {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        progressFill.style.width = progress + '%';
        
        currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        totalTimeEl.textContent = formatTime(audioPlayer.duration);
      }
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return mins + ':' + (secs < 10 ? '0' : '') + secs;
    }

    function seekAudio(e) {
      const rect = progressBar.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const newTime = (clickX / rect.width) * audioPlayer.duration;
      audioPlayer.currentTime = newTime;
    }

    heartBtn.addEventListener('click', triggerRelease);
    heartBtn.addEventListener('keydown', triggerRelease);
    playPauseBtn.addEventListener('click', togglePlayPause);
    progressBar.addEventListener('click', seekAudio);
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('loadedmetadata', updateProgress);

    function releasePhrase() {
      heartBtn.classList.add('clicked');
      setTimeout(() => heartBtn.classList.remove('clicked'), 700);
      heartAura.classList.add('active');
      setTimeout(() => heartAura.classList.remove('active'), 800);
      createParticlesBurst();
      createPhrase();
      if (!instructionHidden) {
        const instructionContainer = document.querySelector('.instruction-container');
        if (instructionContainer) {
          instructionContainer.classList.add('hidden');
          instructionHidden = true;
        }
      }
      // Inicializar bot√≥n como oculto y efectos al cargar
      window.addEventListener('load', function() {
        // Ocultar bot√≥n de carta al inicio
        const letterBtn = document.getElementById('letterBtn');
        if (letterBtn) {
          letterBtn.style.opacity = '0';
          letterBtn.style.pointerEvents = 'none';
        }
        
        // Efecto de part√≠culas en las instrucciones al cargar
        const instructionContainer = document.querySelector('.instruction-container');
        if (instructionContainer) {
          createInstructionParticles();
        }
      });

      // Verificar progreso despu√©s de crear la frase
      checkProgress();
      
    }
    function createInstructionParticles() {
      const container = document.querySelector('.instruction-container');
      if (!container) return;
      
      const rect = container.getBoundingClientRect();
      
      for (let i = 0; i < 15; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'instruction-particle';
          
          // Posici√≥n aleatoria alrededor del texto
          const x = rect.left + Math.random() * rect.width;
          const y = rect.top + Math.random() * rect.height;
          
          particle.style.left = x + 'px';
          particle.style.top = y + 'px';
          
          document.body.appendChild(particle);
          
          // Animaci√≥n
          particle.animate([
            { opacity: 0, transform: 'scale(0) translateY(0)' },
            { opacity: 0.8, transform: 'scale(1) translateY(-10px)' },
            { opacity: 0, transform: 'scale(0) translateY(-30px)' }
          ], {
            duration: 1500 + Math.random() * 1000,
            delay: Math.random() * 1000
          });
          
          // Eliminar despu√©s de animaci√≥n
          setTimeout(() => particle.remove(), 3000);
        }, i * 100);
      }
    }

    function createPhrase() {
      const phraseText = PHRASES[currentPhraseIndex];
      // Incrementa el √≠ndice para la pr√≥xima vez
      currentPhraseIndex++;
      // Si lleg√≥ al final, vuelve al principio
      if (currentPhraseIndex >= PHRASES.length) {
        currentPhraseIndex = 0;
        // Solo marcar como completado si no se hab√≠a completado antes
        if (!allPhrasesShown) {
          console.log("¬°Todas las frases mostradas!");
        }
      }
      
      const el = document.createElement('div');
      el.className = 'phrase shooting';
      el.textContent = phraseText;

      const heartRect = heartBtn.getBoundingClientRect();
      const sceneRect = scene.getBoundingClientRect();
      
      const startX = heartRect.left + heartRect.width / 2 - sceneRect.left;
      const startY = heartRect.top + heartRect.height / 2 - sceneRect.top;

      el.style.left = startX + 'px';
      el.style.top = startY + 'px';

      const angle = Math.random() * 120 - 150;
      
      // Obtener dimensiones de pantalla para ajustar valores
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      const isMobile = screenWidth <= 768;
      
      // Valores ajustados para m√≥vil/desktop
      const shootForce = isMobile ? rand(80, 120) : rand(150, 230);
      const fallDistance = isMobile ? rand(150, 250) : rand(250, 450);
      const horizontalDrift = isMobile ? rand(-60, 60) : rand(-120, 120);
      
      const shootX = Math.cos(angle * Math.PI / 180) * shootForce;
      const shootY = Math.sin(angle * Math.PI / 180) * shootForce;

      const finalX = shootX + horizontalDrift;
      const finalY = shootY + fallDistance;

      // Limitar posici√≥n final para que no salga de pantalla
      const maxHorizontal = screenWidth * 0.35;
      const maxVertical = screenHeight * 0.35;
      const limitedFinalX = Math.max(-maxHorizontal, Math.min(maxHorizontal, finalX));
      const limitedFinalY = Math.max(-maxVertical, Math.min(maxVertical, finalY));

      const initialRotation = rand(-20, 20);
      const finalRotation = initialRotation + rand(-40, 40);
      const duration = rand(4.5, 6.5);

      el.style.setProperty('--shoot-x', shootX + 'px');
      el.style.setProperty('--shoot-y', shootY + 'px');
      el.style.setProperty('--final-x', limitedFinalX + 'px');
      el.style.setProperty('--final-y', limitedFinalY + 'px');
      el.style.setProperty('--rotation', initialRotation + 'deg');
      el.style.setProperty('--final-rotation', finalRotation + 'deg');
      el.style.setProperty('--duration', duration + 's');
      
      scene.appendChild(el);
      el.addEventListener('animationend', () => el.remove(), { once: true });
      }

    function createParticlesBurst() {
      const heartRect = heartBtn.getBoundingClientRect();
      const sceneRect = scene.getBoundingClientRect();
      const centerX = heartRect.left + heartRect.width / 2 - sceneRect.left;
      const centerY = heartRect.top + heartRect.height / 2 - sceneRect.top;

      const particleCount = rand(10, 15);
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle burst';
        
        particle.style.left = centerX + 'px';
        particle.style.top = centerY + 'px';
        
        const angle = Math.random() * 360;
        const distance = rand(50, 90);
        const x = Math.cos(angle * Math.PI / 180) * distance;
        const y = Math.sin(angle * Math.PI / 180) * distance;
        
        particle.style.setProperty('--particle-x', x + 'px');
        particle.style.setProperty('--particle-y', y + 'px');
        
        scene.appendChild(particle);
        particle.addEventListener('animationend', () => particle.remove(), { once: true });
      }
    }

    function rand(min, max) { 
      return Math.random() * (max - min) + min; 
    }
    // A√±ade esta variable al inicio con las otras variables
let letterOpened = false;

// A√±ade estas funciones despu√©s de la funci√≥n rand()
function openLetter() {
  if (letterOpened) return;
  
  letterOpened = true;
  
  // Crear modal de carta
  const modal = document.createElement('div');
  modal.className = 'letter-modal';
  modal.id = 'letterModal';
  
  // Contenido de la carta
  modal.innerHTML = `
    <div class="letter-content">
      <button class="letter-close" id="closeLetter">√ó</button>
      
      <div class="letter-header">
        <h2 class="letter-title">üíå Mi Carta Para Ti</h2>
        <div class="letter-subtitle">Un mensaje especial desde mi coraz√≥n</div>
      </div>
      
      <div class="letter-body">
        <p>Mi amor,</p>
        
        <p>Quiero que sepas lo especial que eres para mi. Eres la mujer que me hizo ver que nada estaba perdido, te encontre en el momento donde nada tenia sentido y valoro mucho que seas ahora la mujer que amo y que quiero que se quede para una eternidad</p>
        
        <p>Tu amor es el refugio m√°s seguro que conozco. Es algo unico y maravilloso que saca lo mejor de mi y me inspira a seguir mejorando como persona, todo para ser felices juntos </p>
        
        <p>Contigo quiero construir una vida, que nos haga sentir orgullosos por haberla vivido juntos. Quiero cumplir todos nuestros objetivos y llegar lejos tomados de la mano</p>
        
        <p>Gracias por ser mi apoyo, mi inspiraci√≥n y mi amor. Gracias por creer en mi incluso cuando yo dudo. Gracias por amarme con esa corazon tan lindo que solo tu lo tienes.</p>
        
        <p>Prometo cuidar de nuestro amor cada dia, llenarlo con cari√±o y con respeto, y construir junto a ti un futuro lleno de sue√±os cumplidos.</p>
        
        <p>No importa las pruebas que nos ponga la vida, se que juntos podemos enfrentarlo todo. Porque contigo, hasta los desafios se convierten en aventuras.</p>
        
        <p>Te amo m√°s de lo que las palabras pueden expresar, m√°s de lo que el tiempo puede medir, m√°s de lo que el universo puede contener.</p>
        
        <p>Eres y ser√°s siempre mi amor bonito.</p>
        <p>Te amo Elizabeth..!!! ‚ù§Ô∏è</p>
      </div>
      
      <div class="letter-footer">
        <p>Con todo mi amor, por siempre y para siempre.</p>
        <p>‚ù§Ô∏è</p>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Mostrar modal con animaci√≥n
  setTimeout(() => {
    modal.classList.add('active');
    createLetterParticles();
  }, 100);
  
  // Cerrar modal
  const closeBtn = modal.querySelector('#closeLetter');
  closeBtn.addEventListener('click', closeLetter);
  
  // Cerrar al hacer clic fuera del contenido
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeLetter();
    }
  });
  
  // Cerrar con tecla ESC
  document.addEventListener('keydown', function closeOnEscape(e) {
    if (e.key === 'Escape') {
      closeLetter();
      document.removeEventListener('keydown', closeOnEscape);
    }
  });
}

function closeLetter() {
  const modal = document.getElementById('letterModal');
  if (!modal) return;
  
  modal.classList.remove('active');
  
  // Esperar animaci√≥n y eliminar
  setTimeout(() => {
    if (modal && modal.parentNode) {
      modal.parentNode.removeChild(modal);
    }
  }, 500);
  letterOpened = false;
}

function createLetterParticles() {
  const modal = document.getElementById('letterModal');
  if (!modal) return;
  
  const content = modal.querySelector('.letter-content');
  const rect = content.getBoundingClientRect();
  
  // Crear part√≠culas de amor
  const particlesCount = 30;
  
  for (let i = 0; i < particlesCount; i++) {
    setTimeout(() => {
      const particle = document.createElement('div');
      particle.className = 'letter-particle';
      
      // Posici√≥n aleatoria dentro de la carta
      const x = rect.left + Math.random() * rect.width;
      const y = rect.top + Math.random() * rect.height;
      
      particle.style.left = x + 'px';
      particle.style.top = y + 'px';
      
      // Color aleatorio
      const colors = ['#ff2b4f', '#ff8fab', '#ffd6e7', '#ffd700'];
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];
      
      modal.appendChild(particle);
      
      // Animaci√≥n
      const size = 2 + Math.random() * 4;
      const duration = 1000 + Math.random() * 1000;
      
      particle.animate([
        {
          opacity: 0,
          transform: `scale(0) translate(0, 0)`
        },
        {
          opacity: 0.8,
          transform: `scale(1) translate(${Math.random() * 40 - 20}px, ${Math.random() * 40 - 20}px)`,
          offset: 0.5
        },
        {
          opacity: 0,
          transform: `scale(0) translate(${Math.random() * 80 - 40}px, ${Math.random() * 80 - 40}px)`
        }
      ], {
        duration: duration,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      });
      
      // Eliminar despu√©s
      setTimeout(() => {
        if (particle.parentNode) {
          particle.parentNode.removeChild(particle);
        }
      }, duration);
    }, i * 100);
  }
}
function showProgressMessage(message) {
  // Evitar m√∫ltiples mensajes simult√°neos
  if (progressMessageActive) return;
  progressMessageActive = true;
  
  // Crear elemento de mensaje
  const messageEl = document.createElement('div');
  messageEl.className = 'progress-message';
  messageEl.textContent = message;
  
// Posicionar ENCIMA del coraz√≥n
  const heartRect = heartBtn.getBoundingClientRect();
  const sceneRect = scene.getBoundingClientRect();
  const centerX = heartRect.left + heartRect.width / 2 - sceneRect.left;

  // Calcular posici√≥n en Y basada en el tama√±o de pantalla
  const isMobile = window.innerWidth <= 768;
  const offsetY = isMobile ? -60 : -80; // M√°s cerca en m√≥vil
  
  const topY = heartRect.top - sceneRect.top - 80; // 80px arriba del coraz√≥n
  
  messageEl.style.left = centerX + 'px';
  messageEl.style.top = topY + 'px';
  
  scene.appendChild(messageEl);
  
  // Animar entrada
  setTimeout(() => {
    messageEl.classList.add('active');
  }, 50);
  
  // Mostrar por 2 segundos y luego desaparecer
  setTimeout(() => {
    messageEl.classList.remove('active');
    messageEl.classList.add('fade-out');
    
    // Eliminar despu√©s de la animaci√≥n
    setTimeout(() => {
      if (messageEl.parentNode) {
        messageEl.parentNode.removeChild(messageEl);
      }
      progressMessageActive = false;
    }, 500);
  }, 3000);
}

// Funci√≥n para verificar progreso y mostrar mensajes
function checkProgress() {


  // Usar currentPhraseIndex - 1 porque ya se increment√≥ en createPhrase()
  const currentProgress = (currentPhraseIndex) / (PHRASES.length-1);
  const progress = currentProgress < 0 ? 0 : currentProgress; // Evitar valores negativos

  
  // Mostrar mensajes seg√∫n el progreso
  PROGRESS_MESSAGES.forEach(msg => {
    if (progress >= msg.threshold && !messagesShown.includes(msg.threshold)) {
      showProgressMessage(msg.text);
      messagesShown.push(msg.threshold);
      // Mostrar bot√≥n cuando se complete el 100%
      if (msg.threshold === 1.0 && !allPhrasesShown) {
        allPhrasesShown = true;
        setTimeout(() => {
          showLetterButton();
        }, 2500);
      }
    }
  });
}

// Funci√≥n para mostrar el bot√≥n de carta
function showLetterButton() {
  const letterBtn = document.getElementById('letterBtn');
  if (letterBtn && !letterBtn.classList.contains('ready')) {
    console.log("Mostrando bot√≥n de carta...");
    
    letterBtn.classList.add('ready');
    
    // Efecto de aparici√≥n
    setTimeout(() => {
      letterBtn.style.opacity = '1';
      letterBtn.style.pointerEvents = 'all';
      letterBtn.style.transition = 'opacity 0.8s ease, transform 0.3s ease';
      
      // Crear efecto de part√≠culas
      createButtonAppearEffect();
      
    }, 0);
  }
}

// Funci√≥n para efecto de aparici√≥n del bot√≥n
function createButtonAppearEffect() {
  const letterBtn = document.getElementById('letterBtn');
  if (!letterBtn) return;
  
  const btnRect = letterBtn.getBoundingClientRect();
  const centerX = btnRect.left + btnRect.width / 2;
  const centerY = btnRect.top + btnRect.height / 2;
  
  // Crear part√≠culas de efecto
  for (let i = 0; i < 8; i++) {
    setTimeout(() => {
      const particle = document.createElement('div');
      particle.style.cssText = `
        position: fixed;
        width: 6px;
        height: 6px;
        background: var(--pink);
        border-radius: 50%;
        left: ${centerX}px;
        top: ${centerY}px;
        pointer-events: none;
        z-index: 9;
        opacity: 0;
        filter: blur(1px);
        box-shadow: 0 0 10px var(--pink);
        display: row;
      `;
      
      document.body.appendChild(particle);
      
      // Animaci√≥n de part√≠cula
      const angle = Math.random() * Math.PI * 2;
      const distance = 40 + Math.random() * 40;
      const duration = 800 + Math.random() * 400;
      
      particle.animate([
        {
          opacity: 0,
          transform: 'scale(0) rotate(0deg)'
        },
        {
          opacity: 1,
          transform: `scale(1) translate(${Math.cos(angle) * distance * 0.3}px, ${Math.sin(angle) * distance * 0.3}px)`,
          offset: 0.3
        },
        {
          opacity: 0,
          transform: `scale(0) translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`
        }
      ], {
        duration: duration,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      });
      
      // Eliminar despu√©s
      setTimeout(() => {
        if (particle.parentNode) {
          particle.parentNode.removeChild(particle);
        }
      }, duration);
    }, i * 100);
  }
}
// EVENT LISTENER - A√±ade esto con los otros event listeners (despu√©s de progressBar)
const letterBtn = document.getElementById('letterBtn');
letterBtn.addEventListener('click', openLetter);
  </script>
</body>
</html>